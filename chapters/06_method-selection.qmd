# 第五部分：情境選擇菜單 {data-stack-name="方法選擇"}

## 本節重點

你的研究結果是什麼類型？

- 連續變數？（血壓、HbA1c）
- 二元變數？（死亡 Y/N）
- 存活時間？（死亡時間）

::: {.fragment}
**不同類型 → 不同方法 → 不同 R 套件**
:::

::: {.notes}
這一節很實用——根據你的結果類型選擇對應的方法和套件。這是一個「菜單」，等一下實作時會用到。
:::

## 流程位置

| 承接 | 本章目標 | 下一步 |
|------|----------|--------|
| 你已掌握 TMLE / Super Learner 的概念 | **依 outcome 與 estimand 做方法選擇** | 準備資料與品質檢查 |

## 一張表搞定方法選擇

| Outcome 類型 | 範例 | 估計什麼 | R 套件 |
|--------------|------|----------|--------|
| 連續 | 血壓、HbA1c | 平均差 | `tmle` |
| 二元 | 死亡 Y/N | Risk Diff / RR | `tmle` |
| 存活 | 死亡時間 | Survival diff | `survtmle` |
| 計數 | 住院次數 | Rate Ratio | `WeightIt` |
| 重複測量 | 多時間點追蹤 | 軌跡差異 | `geepack` |

::: {.notes}
這張表是速查表。連續和二元結果用 tmle 套件，存活結果用 survtmle。最常用的是前三種。計數和重複測量比較少見，有需要再另外學。
:::

## Estimand 的選擇

::: {.callout-note appearance="minimal"}
## 名詞解釋
- **Estimand**：你想估計的「目標量」，要先定義清楚才能選方法
- **ATE** (Average Treatment Effect)：如果讓「所有人」都接受治療 vs 都不接受，平均差異是多少？
- **ATT** (Average Treatment Effect on the Treated)：對於「實際接受治療的人」，治療效果是多少？
:::

::: {.notes}
Estimand 是你想估計的「目標量」。ATE 是「如果所有人都接受治療」的效果，ATT 是「對於實際接受治療的人」的效果。這兩個數字可能不一樣。
:::

## ATE vs ATT：什麼時候用哪個？

::: {.columns}
::: {.column width="50%"}
**ATE（全體平均效果）**

- 問：「如果政策推廣給所有人」
- 需要兩組**充分重疊**
- 樣本小、重疊差時**很不穩定**
:::
::: {.column width="50%"}
**ATT（已治療者效果）**

- 問：「對已經用這治療的人」
- 只需對照組能代表治療組
- 重疊不佳時**更實際可估**
:::
:::

::: {.fragment}
### 實務建議

> 幾百例的臨床資料，**優先考慮 ATT**，除非重疊非常好
:::

::: {.notes}
實務建議：小樣本優先考慮 ATT。為什麼？ATE 需要兩組充分重疊，但臨床資料常常重疊不好。ATT 只需要對照組能代表治療組，比較容易滿足。如果重疊非常好，再考慮 ATE。
:::

## 小結：選擇方法

::: {.incremental}
1. 先確定你的 **結果類型**（連續/二元/存活/計數）
2. 再決定你要估計的 **目標量**（ATE/ATT）
3. 然後選擇對應的 **R 套件**
:::

## 🎯 確認你的選擇 {.center}

::: {.callout-note appearance="minimal"}
## 你的研究設定

根據剛才學的，確認一下：

1. **你的結果變數是什麼類型？**
   - 連續（血壓）/ 二元（死亡）/ 存活（時間到事件）

2. **你要估計 ATE 還是 ATT？**
   - 重疊好 → ATE / 重疊差 → ATT

3. **對應的 R 套件是？**
   - `tmle` / `survtmle` / 其他
:::

::: {.notes}
這是第三個互動時間。請大家花 1-2 分鐘確認自己的研究屬於哪種情況。如果不確定，可以舉手問。
:::

## 本章輸出

- [ ] 能判斷 outcome 類型（連續/二元/存活/計數）
- [ ] 能選擇 estimand（ATE/ATT）並說明理由
- [ ] 能對應到正確的 R 套件

::: {.fragment}
> **下一步**：方法選好了，資料要怎麼準備？
:::

::: {.notes}
選擇方法的三步驟：確定結果類型、決定 estimand、選擇 R 套件。這個流程很重要，要在分析前就決定好，不能事後改。
:::

